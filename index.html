<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nossa Lista de Casamento üíç</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root { --cor-principal: #d4af37; --cor-fundo: #f8f9fa; }
    body { font-family: 'Montserrat', sans-serif; background-color: var(--cor-fundo); margin: 0; padding: 20px; text-align: center; }
    
    .grid-presentes {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      max-width: 1200px;
      margin: 40px auto;
    }

    .card {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      transition: 0.3s;
    }

    .card img { width: 100%; height: 220px; object-fit: cover; background: #eee; border-bottom: 1px solid #eee; }
    .info { padding: 20px; }
    
    .status {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
      margin-bottom: 15px;
      background: #f0f0f0;
      color: #555;
    }

    h3 { margin: 10px 0; font-size: 1.2rem; color: #333; }

    .btn-presentear {
      background: var(--cor-principal);
      color: white;
      border: none;
      padding: 12px;
      width: 100%;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      margin-top: 10px;
    }

    .btn-presentear:disabled { background: #ccc; cursor: not-allowed; }
    .esgotado { opacity: 0.7; filter: grayscale(1); }
  </style>
</head>
<body>

  <h1>Nossa Lista de Presentes üíç</h1>
  <p>Toque no item que deseja nos presentear</p>

  <div class="grid-presentes" id="lista">
    <p id="loading">Carregando presentes...</p>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <script>
    // Configura√ß√£o do Firebase
    var firebaseConfig = {
      apiKey: "AIzaSyCTBqA3PVyxQmIvk8k7Ia1HIeGsci_rqdY",
      authDomain: "lista-casamento-f19c4.firebaseapp.com",
      projectId: "lista-casamento-f19c4"
    };

    firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();
    var listaDiv = document.getElementById("lista");

    // Escutando os dados em tempo real
    db.collection("presentes").onSnapshot(function(snapshot) {
      if (snapshot.empty) {
        listaDiv.innerHTML = "<p>Nenhum presente encontrado no banco de dados.</p>";
        return;
      }

      listaDiv.innerHTML = ""; // Remove o texto de carregamento

      snapshot.forEach(function(doc) {
        var p = doc.data();
        var id = doc.id;

        // Validando dados do Firestore (visto na sua imagem)
        var total = p.total || 1;
        var recebidos = p.recebidos || 0;
        var nome = p.nome || "Presente";
        var imagem = p.imagem || "https://via.placeholder.com/300";
        var esgotado = recebidos >= total;

        // Criando o elemento do Card
        var card = document.createElement("div");
        card.className = "card" + (esgotado ? " esgotado" : "");

        // Vari√°veis auxiliares para o texto
        var textoStatus = esgotado ? "‚ùå Esgotado" : "üéÅ Recebidos: " + recebidos + " de " + total;
        var textoBotao = esgotado ? "Indispon√≠vel" : "Escolher este";
        var atributoDisabled = esgotado ? "disabled" : "";

        // Montando o HTML interno sem usar o caractere '$' problem√°tico
        card.innerHTML = 
          '<img src="' + imagem + '" alt="' + nome + '">' +
          '<div class="info">' +
            '<span class="status">' + textoStatus + '</span>' +
            '<h3>' + nome + '</h3>' +
            '<button class="btn-presentear" ' + atributoDisabled + ' onclick="confirmar(\'' + id + '\')">' +
              textoBotao +
            '</button>' +
          '</div>';

        listaDiv.appendChild(card);
      });
    }, function(error) {
      console.error("Erro no Firebase:", error);
      listaDiv.innerHTML = "<p style='color:red'>Erro de permiss√£o ou conex√£o.</p>";
    });

    // Fun√ß√£o para confirmar o presente
    function confirmar(id) {
      if(confirm("Deseja confirmar que dar√° este presente?")) {
        db.collection("presentes").doc(id).update({
          recebidos: firebase.firestore.FieldValue.increment(1)
        }).then(function() {
          alert("Muito obrigado! Recebemos sua confirma√ß√£o. ‚ù§Ô∏è");
        }).catch(function(err) {
          alert("Erro ao confirmar. Verifique as regras do banco de dados.");
        });
      }
    }
  </script>
</body>
</html>
