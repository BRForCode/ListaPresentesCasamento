<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Convidados - Patr√≠cia & Luiz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Estilos mantidos para garantir o layout */
        :root { --noivo: #2c3e50; --noiva: #e74c3c; --whatsapp: #25D366; }
        body { font-family: sans-serif; background: #f4f7f6; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .dashboard { display: flex; justify-content: space-around; background: #eee; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .btn-lado { flex: 1; padding: 15px; border: none; border-radius: 8px; cursor: pointer; color: white; margin: 5px; }
        .btn-luiz { background: var(--noivo); }
        .btn-patricia { background: var(--noiva); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border-bottom: 1px solid #ddd; padding: 10px; text-align: left; }
        .btn-wa { background: var(--whatsapp); color: white; padding: 5px 10px; border-radius: 5px; text-decoration: none; font-size: 0.8em; }
    </style>
</head>
<body>

<div class="container" id="app" style="display:none;">
    <h2>üë∞ü§µ Gest√£o de Convidados</h2>
    
    <div class="dashboard">
        <div>Total Geral: <span id="total-geral">0</span></div>
        <div>Confirmados: <span id="conf-geral">0</span></div>
    </div>

    <div style="display: flex;">
        <button class="btn-lado btn-luiz" onclick="filtrarLista('Luiz')">Lista do Luiz</button>
        <button class="btn-lado btn-patricia" onclick="filtrarLista('Patricia')">Lista da Patr√≠cia</button>
    </div>

    <div id="lista-secao" style="display: none;">
        <h3 id="titulo-lado">Lista</h3>
        <p id="stats-lado"></p>

        <div style="margin-bottom: 20px;">
            <input type="text" id="novo-nome" placeholder="Nome">
            <input type="text" id="novo-contato" placeholder="WhatsApp ou Respons√°vel">
            <button onclick="salvarNovo()">Adicionar</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Contato</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="tabela-corpo"></tbody>
        </table>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, updateDoc, addDoc, query, where } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

    // --- IMPORTANTE: PREENCHA COM SEUS DADOS DO FIREBASE ---
    const firebaseConfig = {
        apiKey: "SUA_API_KEY",
        authDomain: "SEU_PROJETO.firebaseapp.com",
        projectId: "SEU_PROJETO",
        storageBucket: "SEU_PROJETO.appspot.com",
        messagingSenderId: "ID_AQUI",
        appId: "APP_ID_AQUI"
    };

    try {
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Senha de acesso
        const senhaAcesso = prompt("Senha de acesso:");
        if(senhaAcesso === "1306") { 
            document.getElementById('app').style.display = 'block';
        } else {
            alert("Senha incorreta!");
            window.location.href = "index.html";
        }

        let currentLado = "";

        window.filtrarLista = async (lado) => {
            currentLado = lado;
            const q = query(collection(db, "convidados"), where("lado", "==", lado));
            const snap = await getDocs(q);
            const convidados = snap.docs.map(d => ({ id: d.id, ...d.data() }));

            document.getElementById('lista-secao').style.display = 'block';
            document.getElementById('titulo-lado').innerText = "Convidados de " + lado;
            
            const conf = convidados.filter(c => c.confirmado === true).length;
            document.getElementById('stats-lado').innerText = Total: ${convidados.length} | Confirmados: ${conf};

            const corpo = document.getElementById('tabela-corpo');
            corpo.innerHTML = "";
            convidados.forEach(c => {
                const num = c.telefone.replace(/\D/g, '');
                const contato = num.length >= 10 ? 
                    <a href="https://wa.me/55${num}?text=Ol√°" target="_blank" class="btn-wa">WhatsApp</a> : 
                    <span>${c.telefone}</span>;
                
                corpo.innerHTML += `
                    <tr>
                        <td>${c.nome}</td>
                        <td>${contato}</td>
                        <td>
                            <button onclick="mudarStatus('${c.id}', true)">Sim</button>
                            <button onclick="mudarStatus('${c.id}', false)">N√£o</button>
                            <span>${c.confirmado === true ? '‚úÖ' : (c.confirmado === false ? '‚ùå' : '‚è≥')}</span>
                        </td>
                    </tr>`;
            });
            atualizarGeral();
        };

        window.mudarStatus = async (id, status) => {
            await updateDoc(doc(db, "convidados", id), { confirmado: status });
            filtrarLista(currentLado);
        };

        window.salvarNovo = async () => {
            const nome = document.getElementById('novo-nome').value;
            const tel = document.getElementById('novo-contato').value;
            await addDoc(collection(db, "convidados"), { nome, telefone: tel, lado: currentLado, confirmado: null });
            filtrarLista(currentLado);
        };

        async function atualizarGeral() {
            const snap = await getDocs(collection(db, "convidados"));
            const total = snap.size;
            const conf = snap.docs.filter(d => d.data().confirmado === true).length;
            document.getElementById('total-geral').innerText = total;
            document.getElementById('conf-geral').innerText = conf;
        }

        atualizarGeral();

    } catch (error) {
        console.error("Erro ao carregar o Firebase:", error);
        alert("Erro t√©cnico. Verifique o console (F12).");
    }
</script>
</body>
</html>
