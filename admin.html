<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Administrativo - Patricia & Luiz</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --cor-principal: #d4af37; --cor-verde: #27ae60; --cor-vermelho: #e74c3c; --cor-azul: #3498db; }
    
    body { font-family: 'Montserrat', sans-serif; background-color: #f0f2f5; padding: 20px; color: #333; margin: 0; }
    .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    h1, h2 { text-align: center; color: var(--cor-principal); }

    /* Telas de Bloqueio e Menu */
    #bloqueio, #menu-inicial { position: fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:9999; display: flex; align-items: center; justify-content: center; flex-direction: column; }
    #menu-inicial { display: none; z-index: 9998; }

    .btn-menu { width: 250px; padding: 20px; margin: 10px; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: 0.3s; color: white; }
    .btn-p { background: var(--cor-principal); }
    .btn-m { background: var(--cor-azul); }
    .btn-menu:hover { transform: scale(1.05); filter: brightness(1.1); }

    .secao-admin { display: none; }
    .btn-voltar { background: #666; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-bottom: 20px; }

    /* Estilos de Presentes */
    .form-novo { background: #fdfaf0; padding: 20px; border-radius: 10px; border: 1px solid #f1e4bc; margin-bottom: 30px; }
    .input-edit { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
    .item-admin { border: 1px solid #ddd; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
    .item-header { display: flex; align-items: center; gap: 15px; margin-bottom: 10px; }
    .item-header img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; }

    /* Estilos de Mensagens */
    .msg-card { border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; gap: 10px; }
    .msg-inputs { flex-grow: 1; display: flex; flex-direction: column; gap: 5px; }
    .label-mini { font-size: 10px; color: #999; text-transform: uppercase; font-weight: bold; }
    
    button { cursor: pointer; font-weight: 600; transition: 0.2s; }
    .btn-save { background: var(--cor-azul); color: white; border: none; padding: 10px; border-radius: 5px; }
    .btn-del { background: var(--cor-vermelho); color: white; border: none; padding: 10px; border-radius: 5px; }
  </style>
</head>
<body>

  <div id="bloqueio">
    <h2>Acesso Restrito</h2>
    <input type="password" id="senhaInput" placeholder="Senha do Admin" style="padding: 10px; margin-bottom: 10px;">
    <button onclick="verificarSenha()" style="padding: 10px 20px;">Entrar</button>
  </div>

  <div id="menu-inicial">
    <h2>O que deseja alterar?</h2>
    <button class="btn-menu btn-p" onclick="mostrarSecao('presentes')">üéÅ Presentes</button>
    <button class="btn-menu btn-m" onclick="mostrarSecao('mensagens')">üìù Mensagens</button>
  </div>

  <div class="container">
    <button class="btn-voltar" onclick="voltarAoMenu()">‚Üê Voltar ao Menu</button>

    <div id="secao-presentes" class="secao-admin">
      <h1>Gerenciar Presentes</h1>
      <div class="form-novo">
        <h3>Adicionar Novo Item</h3>
        <input type="text" id="nome" placeholder="Nome" class="input-edit" style="margin-bottom: 5px;">
        <input type="text" id="imagem" placeholder="Link da Imagem" class="input-edit" style="margin-bottom: 5px;">
        <input type="number" id="total" value="1" min="1" class="input-edit" style="margin-bottom: 5px;">
        <button onclick="adicionarPresente()" class="btn-save" style="width:100%; background: var(--cor-verde);">Cadastrar Presente</button>
      </div>
      <div id="lista-presentes">Carregando...</div>
    </div>

    <div id="secao-mensagens" class="secao-admin">
      <h1>Gerenciar Mural</h1>
      <div id="lista-mensagens">Carregando...</div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <script>
    function verificarSenha() {
      if (document.getElementById("senhaInput").value === "1234") {
        document.getElementById("bloqueio").style.display = "none";
        document.getElementById("menu-inicial").style.display = "flex";
      } else { alert("Senha incorreta!"); }
    }

    function mostrarSecao(tipo) {
      document.getElementById("menu-inicial").style.display = "none";
      document.querySelectorAll('.secao-admin').forEach(s => s.style.display = "none");
      document.getElementById("secao-" + tipo).style.display = "block";
    }

    function voltarAoMenu() {
      document.getElementById("menu-inicial").style.display = "flex";
      document.querySelectorAll('.secao-admin').forEach(s => s.style.display = "none");
    }

    var firebaseConfig = {
      apiKey: "AIzaSyCTBqA3PVyxQmIvk8k7Ia1HIeGsci_rqdY",
      authDomain: "lista-casamento-f19c4.firebaseapp.com",
      projectId: "lista-casamento-f19c4"
    };
    firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();

    // --- PRESENTES ---
    function adicionarPresente() {
      var n = document.getElementById("nome").value, i = document.getElementById("imagem").value, t = parseInt(document.getElementById("total").value);
      if (!n || !i) return alert("Preencha tudo!");
      db.collection("presentes").add({ nome: n, imagem: i, total: t, recebidos: 0 }).then(() => {
        alert("Adicionado!");
        document.getElementById("nome").value = ""; document.getElementById("imagem").value = "";
      });
    }

    db.collection("presentes").onSnapshot(snap => {
      var div = document.getElementById("lista-presentes");
      div.innerHTML = "";
      snap.forEach(doc => {
        var p = doc.data(), id = doc.id;
        var item = document.createElement("div");
        item.className = "item-admin";
        item.innerHTML = `
          <div class="item-header"><img src="${p.imagem}"><strong>${p.nome}</strong></div>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-bottom:10px;">
            <label class="label-mini">Total</label><label class="label-mini">Recebidos</label>
            <input type="number" id="t-${id}" value="${p.total}" class="input-edit">
            <input type="number" id="r-${id}" value="${p.recebidos}" class="input-edit">
          </div>
          <label class="label-mini">URL da Imagem</label>
          <input type="text" id="i-${id}" value="${p.imagem}" class="input-edit" style="margin-bottom:10px;">
          <button class="btn-save" style="width:70%" onclick="salvarP('${id}')">Salvar Altera√ß√µes</button>
          <button class="btn-del" style="width:25%" onclick="excluirP('${id}')">Excluir</button>`;
        div.appendChild(item);
      });
    });

    function salvarP(id) {
      db.collection("presentes").doc(id).update({
        total: parseInt(document.getElementById("t-"+id).value),
        recebidos: parseInt(document.getElementById("r-"+id).value),
        imagem: document.getElementById("i-"+id).value
      }).then(() => alert("Presente atualizado!"));
    }

    function excluirP(id) { if(confirm("Excluir presente?")) db.collection("presentes").doc(id).delete(); }

    // --- MENSAGENS (COM EDI√á√ÉO DE NOME) ---
    db.collection("mensagens").orderBy("timestamp", "desc").onSnapshot(snap => {
      var div = document.getElementById("lista-mensagens");
      div.innerHTML = "";
      snap.forEach(doc => {
        var m = doc.data(), id = doc.id;
        var card = document.createElement("div");
        card.className = "msg-card";
        card.innerHTML = `
          <div class="msg-inputs">
            <label class="label-mini">Nome do Convidado</label>
            <input type="text" id="mn-${id}" value="${m.nome}" class="input-edit" style="font-weight: bold;">
            <label class="label-mini">Mensagem</label>
            <input type="text" id="mt-${id}" value="${m.texto}" class="input-edit">
          </div>
          <div style="display: flex; flex-direction: column; gap: 5px;">
            <button class="btn-save" onclick="salvarM('${id}')">üíæ</button>
            <button class="btn-del" onclick="excluirM('${id}')">üóëÔ∏è</button>
          </div>`;
        div.appendChild(card);
      });
    });

    function salvarM(id) { 
      var novoNome = document.getElementById("mn-"+id).value;
      var novoTexto = document.getElementById("mt-"+id).value;
      
      db.collection("mensagens").doc(id).update({ 
        nome: novoNome,
        texto: novoTexto 
      }).then(() => alert("Mensagem e nome atualizados!")); 
    }

    function excluirM(id) { if(confirm("Excluir mensagem?")) db.collection("mensagens").doc(id).delete(); }
  </script>
</body>
</html>
